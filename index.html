<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8"/>
  <link href="favicon.ico" rel="icon" type="image/x-icon"/>
  <link href="apple-touch-icon.png" rel="apple-touch-icon"/>
  <meta content="yes" name="apple-mobile-web-app-capable"/>
  <meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"/>
  <meta content="#1f334d" name="theme-color"/>
  <meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" name="viewport"/>
  <title>Biblioteca Jurídica – ANF</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <style>
    :root { --primary: #1f334d; --accent: #e63946; --bg: #f5f7fa; --text: #333; --card-bg: #fff; --radius: 12px; --shadow: 0 2px 10px rgba(0,0,0,0.08); }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; height: 100vh; display: flex; flex-direction: column; background: var(--bg); color: var(--text); overflow: hidden; }
    header { background: var(--primary); color: #fff; padding: 1rem; }
    .title-bar { display: flex; align-items: center; }
    .title-bar h1 { flex: 1; font-size: 1.4rem; font-weight: 600; }
    .search-bar { display: flex; align-items: center; background: #fff; border-radius: 50px; padding: 0.5rem 1rem; margin-top: 0.75rem; box-shadow: var(--shadow); }
    .search-bar input { flex: 1; border: none; outline: none; font-size: 1rem; background: transparent; padding: 0.25rem; }
    .search-icon { color: #666; margin-right: 0.5rem; }
    .toolbar { display: flex; align-items: center; justify-content: space-between; padding: 0.75rem; background: #e8ebf0; border-bottom: 1px solid rgba(0,0,0,0.1); }
    .btn { background: rgba(255,255,255,0.8); border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; box-shadow: var(--shadow); color: var(--primary); font-size: 1.1rem; }
    .btn.active { background: var(--primary); color: #fff; }
    .view-btns { display: flex; gap: 0.5rem; }
    .container { flex: 1; overflow-y: auto; padding: 0.75rem; }
    .doc-grid { display: grid; grid-template-columns: repeat(2,1fr); gap: 0.75rem; }
    .doc-list { display: flex; flex-direction: column; gap: 0.5rem; }
    .doc-item { background: var(--card-bg); border-radius: var(--radius); padding: 1.25rem 0.75rem; display: flex; flex-direction: column; align-items: center; gap: 0.75rem; box-shadow: var(--shadow); border-top: 4px solid var(--primary); cursor: pointer; }
    .doc-item.calculadora { border-top-color: #2a5d68; background: #f1f6f5; }
    .doc-icon { font-size: 2rem; color: var(--primary); }
    .doc-title { text-align: center; font-weight: 600; font-size: 0.85rem; line-height: 1.3; }
    #viewer { display: none; padding: 1rem; flex: 1; overflow-y: auto; background: #fff; line-height: 1.5; font-size: 1rem; }
    #viewer h1 { font-size: 1.4rem; margin: 1rem 0; }
    .highlight { background: #ffe169; padding: 0 2px; border-radius: 2px; }
    .search-results { position: fixed; bottom: 1rem; left: 50%; transform: translateX(-50%); background: var(--primary); border-radius: 50px; color: white; padding: 0.5rem; display: flex; align-items: center; gap: 0.5rem; box-shadow: var(--shadow); z-index: 100; display: none; }
    .search-results button { background: rgba(255,255,255,0.2); border: none; border-radius: 50%; width: 30px; height: 30px; color: white; display: flex; align-items: center; justify-content: center; }
    @media (max-width:480px) { .doc-grid { grid-template-columns: 1fr; } .btn { width: 36px; height: 36px; font-size: 1rem; } }
  </style>
</head>
<body>
  <header>
    <div class="title-bar">
      <h1>Biblioteca Jurídica</h1>
    </div>
    <div class="search-bar">
      <i class="fa-solid fa-magnifying-glass search-icon"></i>
      <input id="search" type="text" placeholder="Buscar..." />
    </div>
  </header>
  <div class="toolbar" id="view-toolbar">
    <div class="view-btns">
      <button class="btn active" id="grid-view-btn" title="Vista en cuadrícula"><i class="fa-solid fa-table-cells"></i></button>
      <button class="btn" id="list-view-btn" title="Vista en lista"><i class="fa-solid fa-list"></i></button>
    </div>
  </div>
  <div class="container">
    <div class="doc-grid" id="docList"></div>
    <div id="viewer"></div>
  </div>
  <div class="search-results">
    <button id="prev-result"><i class="fa-solid fa-chevron-up"></i></button>
    <span id="result-counter">0 de 0</span>
    <button id="next-result"><i class="fa-solid fa-chevron-down"></i></button>
    <button id="close-search"><i class="fa-solid fa-xmark"></i></button>
  </div>
  <script>
    const docList = document.getElementById('docList');
    const viewer = document.getElementById('viewer');
    const searchInput = document.getElementById('search');
    const viewToolbar = document.getElementById('view-toolbar');
    const gridBtn = document.getElementById('grid-view-btn');
    const listBtn = document.getElementById('list-view-btn');

    const docs = [
      { file: 'documento1.html', title: 'CÓDIGO PENAL', icon: 'fa-solid fa-gavel' },
      { file: 'documento2.html', title: 'CÓDIGO PROCESAL PENAL', icon: 'fa-solid fa-scale-balanced' },
      { file: 'documento3.html', title: 'LEY DE DROGAS', icon: 'fa-solid fa-pills' },
      { file: 'documento4.html', title: 'LEY DE CONTROL DE ARMAS', icon: 'fa-solid fa-gun' },
      { file: 'documento5.html', title: 'LEY DE PENAS SUSTITUTIVAS', icon: 'fa-solid fa-person-walking-arrow-right' },
      { file: 'documento6.html', title: 'LEY DE VIOLENCIA INTRAFAMILIAR', icon: 'fa-solid fa-house-user' },
      { file: 'documento7.html', title: 'LEY RPA', icon: 'fa-solid fa-child' },
      { file: 'documento8.html', title: 'LEY RPA (Diferida)', icon: 'fa-solid fa-child-reaching' },
      { file: 'documento9.html', title: 'LEY DE VIOLENCIA EN LOS ESTADIOS', icon: 'fa-solid fa-futbol' },
      { file: 'documento10.html', title: 'LEY DE TRÁNSITO', icon: 'fa-solid fa-car' },
      { file: 'documento11.html', title: 'LEY ORGÁNICA DEL MINISTERIO PÚBLICO', icon: 'fa-solid fa-building-columns' },
      { file: 'calculadora_abonos.html', title: 'Calculadora Abonos por Arresto', icon: 'fa-solid fa-calculator', type: 'calculadora' },
      { file: 'minutas.html', title: 'Minutas de Jurisprudencia', icon: 'fa-solid fa-book-open', type: 'minutas' }
    ];

    function buildList() {
      docList.innerHTML = '';
      docs.forEach(d => {
        const card = document.createElement('div');
        card.className = 'doc-item';
        if (d.type) card.classList.add(d.type);
        card.innerHTML = `<div class="doc-icon"><i class="${d.icon}"></i></div><div class="doc-title">${d.title}</div>`;
        card.addEventListener('click', () => openDoc(d.file, d.title));
        docList.appendChild(card);
      });
    }

    async function openDoc(file, title) {
      docList.style.display = 'none';
      viewToolbar.style.display = 'none';
      viewer.style.display = 'block';
      viewer.innerHTML = '<div class="loading"><i class="fa-solid fa-circle-notch fa-spin"></i> Cargando...</div>';
      try {
        const res = await fetch(file);
        const txt = await res.text();
        document.title = `${title} – Biblioteca Jurídica`;
        let html;
        if (file.endsWith('.md')) html = marked.parse(txt);
        else {
          const p = new DOMParser();
          const docHtml = p.parseFromString(txt, 'text/html');
          html = docHtml.body ? docHtml.body.innerHTML : txt;
        }
        viewer.innerHTML = html;
        hljs.highlightAll();
        const saved = localStorage.getItem('fontSize');
        if (saved) viewer.style.fontSize = saved;
      } catch (e) {
        viewer.innerHTML = `<div class="error">Error cargando documento.</div>`;
      }
    }

    let highlights = [], current = -1, lastTerm = '';
    function highlight(term) {
      if (!term) return resetHighlight();
      viewer.innerHTML = viewer.dataset.original;
      const rx = new RegExp(`(${term})`, 'gi');
      viewer.querySelectorAll('*').forEach(el => {
        el.childNodes.forEach(n => {
          if (n.nodeType === Node.TEXT_NODE) {
            const parts = n.textContent.split(rx);
            if (parts.length>1) {
              const frag = document.createDocumentFragment();
              parts.forEach(p => {
                if (rx.test(p)) {
                  const sp = document.createElement('span'); sp.className='highlight'; sp.textContent=p; frag.appendChild(sp);
                } else frag.appendChild(document.createTextNode(p));
              });
              n.parentNode.replaceChild(frag,n);
            }
          }
        });
      });
      highlights = Array.from(viewer.querySelectorAll('.highlight'));
      if (highlights.length) { document.querySelector('.search-results').style.display='flex'; goTo(0); }
    }
    function goTo(i) { if(!highlights.length) return; current=(i+highlights.length)%highlights.length; highlights[current].scrollIntoView({behavior:'smooth',block:'center'}); document.getElementById('result-counter').textContent=`${current+1} de ${highlights.length}`; }
    function resetHighlight() { viewer.innerHTML=viewer.dataset.original; document.querySelector('.search-results').style.display='none'; highlights=[]; current=-1; lastTerm=''; }

    function doSearch() {
      const term = searchInput.value.trim(); if (!term) return;
      if (viewer.style.display==='block') { if (term===lastTerm) return goTo(current+1); lastTerm=term; viewer.dataset.original=viewer.innerHTML; highlight(term); }
    }

    document.getElementById('prev-result').addEventListener('click', ()=>goTo(current-1));
    document.getElementById('next-result').addEventListener('click', ()=>goTo(current+1));
    document.getElementById('close-search').addEventListener('click', ()=>{ searchInput.value=''; resetHighlight(); });
    searchInput.addEventListener('input', ()=>{ clearTimeout(searchInput.timer); searchInput.timer=setTimeout(doSearch,300); });

    gridBtn.addEventListener('click', ()=>{ docList.className='doc-grid'; gridBtn.classList.add('active'); listBtn.classList.remove('active'); localStorage.setItem('view','grid'); });
    listBtn.addEventListener('click', ()=>{ docList.className='doc-list'; listBtn.classList.add('active'); gridBtn.classList.remove('active'); localStorage.setItem('view','list'); });

    function goHome() {
      document.title='Biblioteca Jurídica – ANF'; viewer.style.display='none'; docList.style.display='grid'; viewToolbar.style.display='flex'; resetHighlight();
    }
    document.body.addEventListener('click', e=>{ if(e.target.id==='btn-back') goHome(); });
    document.addEventListener('DOMContentLoaded', ()=>{ buildList(); const v=localStorage.getItem('view'); if(v==='list') listBtn.click(); });
  </script>
</body>
</html>
